ROOT_DIR:=$(shell dirname $(realpath $(firstword $(MAKEFILE_LIST))))
.SILENT: init test-samp test-openmp

init:
	git submodule update --init --recursive
	ln -s $(ROOT_DIR)/src/build $(ROOT_DIR)/samp/gamemodes
	ln -s $(ROOT_DIR)/src/build $(ROOT_DIR)/open.mp/gamemodes

test-samp:
	sed -i 's/open.mp/a_samp/g' src/test.pwn
	rm -rf src/build/test.amx
	pawncc src/test.pwn -osrc/build/test.amx -isrc/libs/samp-stdlib -isrc/libs/pawn-stdlib -d3 -Z+ -\(+ -\;
	cd samp && ./run-samp

test-openmp:
	sed -i 's/a_samp/open.mp/g' src/test.pwn
	rm -rf src/build/test.amx
	pawncc src/test.pwn -osrc/build/test.amx -isrc/libs/omp-stdlib -d3 -Z+ -\(+ -\;
	cd open.mp && ./run-omp

clean:
	rm -rf samp/gamemodes
	rm -rf open.mp/gamemodes
	rm -rf src/build/test.amx

